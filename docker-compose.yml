# Luanti Server Docker Compose - For End Users (Pre-built Image)
# Just run: docker-compose up -d
#
# First-time deployment with admin setup:
#   ADMIN_PASSWORD=yourpassword docker-compose up -d
#
# Start new world with specific seed:
#   GAME_SEED=12345 ADMIN_PASSWORD=yourpassword docker-compose up -d
#
# Optional environment variables:
#   ADMIN_USER=customadmin (defaults to "admin")
#   GAME_SEED=12345 (world generation seed, only for new worlds)
#   MTUI_PORT_MINECLONIA=8000 (web admin for Mineclonia)
#   MTUI_PORT_VOXELIBRE=8001 (web admin for VoxeLibre)

services:
  mineclonia:
    image: hackboxguy/luanti-home-server:latest
    container_name: luanti_mineclonia
    restart: unless-stopped
    stdin_open: true
    tty: true
    ports:
      - "30000:30000/udp"
    volumes:
      - ./worlds/mineclonia:/luanti/luanti/worlds/world
      - ./config/mineclonia.conf:/luanti/luanti/config/luanti.conf
      - ./tools/questions.json:/luanti/luanti/mods/quest_helper/questions.json:ro
    environment:
      - GAME_TO_PLAY=mineclonia
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - ADMIN_USER=${ADMIN_USER:-admin}
      - GAME_SEED=${GAME_SEED:-}

  voxelibre:
    image: hackboxguy/luanti-home-server:latest
    container_name: luanti_voxelibre
    restart: unless-stopped
    stdin_open: true
    tty: true
    ports:
      - "30001:30000/udp"
    volumes:
      - ./worlds/voxelibre:/luanti/luanti/worlds/world
      - ./config/voxelibre.conf:/luanti/luanti/config/luanti.conf
      - ./tools/questions.json:/luanti/luanti/mods/quest_helper/questions.json:ro
    environment:
      - GAME_TO_PLAY=voxelibre
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - ADMIN_USER=${ADMIN_USER:-admin}
      - GAME_SEED=${GAME_SEED:-}

  # Web Admin for Mineclonia
  mtui-mineclonia:
    image: ghcr.io/minetest-go/mtui:v1.86
    container_name: mtui_mineclonia
    restart: unless-stopped
    depends_on:
      - mineclonia
    ports:
      - "${MTUI_PORT_MINECLONIA:-8000}:8080"
    volumes:
      - ./worlds/mineclonia:/world
      - ./config/mineclonia.conf:/world/minetest.conf:ro
    environment:
      - WORLD_DIR=/world
      - MINETEST_CONFIG=/world/minetest.conf
      - API_KEY=luanti-mtui-secret-key-2025
      - ADMIN_USERNAME=${ADMIN_USER:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - SERVER_NAME=Mineclonia Admin
      - LOGLEVEL=info
      - COOKIE_DOMAIN=
      - COOKIE_SECURE=false
      - ENABLE_FEATURES=api,shell,luashell,minetest_config,modmanagement,signup,chat

  # Web Admin for VoxeLibre
  mtui-voxelibre:
    image: ghcr.io/minetest-go/mtui:v1.86
    container_name: mtui_voxelibre
    restart: unless-stopped
    depends_on:
      - voxelibre
    ports:
      - "${MTUI_PORT_VOXELIBRE:-8001}:8080"
    volumes:
      - ./worlds/voxelibre:/world
      - ./config/voxelibre.conf:/world/minetest.conf:ro
    environment:
      - WORLD_DIR=/world
      - MINETEST_CONFIG=/world/minetest.conf
      - API_KEY=luanti-mtui-secret-key-2025
      - ADMIN_USERNAME=${ADMIN_USER:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - SERVER_NAME=VoxeLibre Admin
      - LOGLEVEL=info
      - COOKIE_DOMAIN=
      - COOKIE_SECURE=false
      - ENABLE_FEATURES=api,shell,luashell,minetest_config,modmanagement,signup,chat
