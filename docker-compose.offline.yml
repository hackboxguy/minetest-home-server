# Luanti Server Docker Compose - OFFLINE/LAN OPTIMIZED
# Use this for home network gaming with performance optimizations
# Run: docker-compose -f docker-compose.offline.yml up -d
#
# First-time deployment with admin setup:
#   ADMIN_PASSWORD=yourpassword docker-compose -f docker-compose.offline.yml up -d

services:
  mineclonia:
    image: hackboxguy/luanti-home-server:latest
    container_name: luanti_mineclonia
    restart: unless-stopped
    stdin_open: true
    tty: true
    ports:
      - "30000:30000/udp"
    volumes:
      - ./worlds/mineclonia:/luanti/luanti/worlds/world
      - ./config/mineclonia-offline.conf:/luanti/luanti/config/luanti.conf
      # Mount only custom mods (keeps Docker image mods intact)
      - ./mods/quest_helper:/luanti/luanti/mods/quest_helper
      - ./mods/admin_init:/luanti/luanti/mods/admin_init
      - ./mods/no_register:/luanti/luanti/mods/no_register
    environment:
      - GAME_TO_PLAY=mineclonia
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - ADMIN_USER=${ADMIN_USER:-admin}

  voxelibre:
    image: hackboxguy/luanti-home-server:latest
    container_name: luanti_voxelibre
    restart: unless-stopped
    stdin_open: true
    tty: true
    ports:
      - "30001:30000/udp"
    volumes:
      - ./worlds/voxelibre:/luanti/luanti/worlds/world
      - ./config/voxelibre-offline.conf:/luanti/luanti/config/luanti.conf
      # Mount only custom mods (keeps Docker image mods intact)
      - ./mods/quest_helper:/luanti/luanti/mods/quest_helper
      - ./mods/admin_init:/luanti/luanti/mods/admin_init
      - ./mods/no_register:/luanti/luanti/mods/no_register
    environment:
      - GAME_TO_PLAY=voxelibre
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - ADMIN_USER=${ADMIN_USER:-admin}

  # Web Admin for Mineclonia
  mtui-mineclonia:
    image: ghcr.io/minetest-go/mtui:v1.86
    container_name: mtui_mineclonia
    restart: unless-stopped
    depends_on:
      - mineclonia
    ports:
      - "${MTUI_PORT_MINECLONIA:-8000}:8080"
    volumes:
      - ./worlds/mineclonia:/world
      - ./config/mineclonia-offline.conf:/world/minetest.conf:ro
    environment:
      - WORLD_DIR=/world
      - MINETEST_CONFIG=/world/minetest.conf
      - API_KEY=luanti-mtui-secret-key-2025
      - ADMIN_USERNAME=${ADMIN_USER:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - SERVER_NAME=Mineclonia Admin (LAN)
      - LOGLEVEL=info
      - COOKIE_DOMAIN=
      - COOKIE_SECURE=false
      - ENABLE_FEATURES=api,shell,luashell,minetest_config,modmanagement,signup,chat

  # Web Admin for VoxeLibre
  mtui-voxelibre:
    image: ghcr.io/minetest-go/mtui:v1.86
    container_name: mtui_voxelibre
    restart: unless-stopped
    depends_on:
      - voxelibre
    ports:
      - "${MTUI_PORT_VOXELIBRE:-8001}:8080"
    volumes:
      - ./worlds/voxelibre:/world
      - ./config/voxelibre-offline.conf:/world/minetest.conf:ro
    environment:
      - WORLD_DIR=/world
      - MINETEST_CONFIG=/world/minetest.conf
      - API_KEY=luanti-mtui-secret-key-2025
      - ADMIN_USERNAME=${ADMIN_USER:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - SERVER_NAME=VoxeLibre Admin (LAN)
      - LOGLEVEL=info
      - COOKIE_DOMAIN=
      - COOKIE_SECURE=false
      - ENABLE_FEATURES=api,shell,luashell,minetest_config,modmanagement,signup,chat
